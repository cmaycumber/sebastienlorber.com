# Cross-platform: ReactNative, Jamstack, and beyond...

<img
        src="./seb.jpeg"
        style={{
                width: 150,
                height: 150,
                borderRadius: 100,
                alignSelf: 'center',
        }}
/>

<br />

- Twitter: [@sebastienlorber](https://twitter.com/sebastienlorber)
- Github: [@slorber](https://github.com/slorber/)
- Blog: [sebastienlorber.com](https://sebastienlorber.com/)

---

# Blog project

<img src="./logos/gatsby.png" style={{ position: 'absolute', top: 350, left: 500, width: 300 }} />

<img src="./logos/reasonml.png" style={{ position: 'absolute', top: 200, left: 850, width: 200 }} />

<img src="./logos/yarn.png" style={{ position: 'absolute', top: 550, left: 100, width: 200 }} />

<img src="./logos/lerna.png" style={{ position: 'absolute', top: 540, left: 380, width: 200 }} />

<img src="./logos/apollo.png" style={{ position: 'absolute', top: 220, left: 200, width: 200 }} />

<img
        src="./logos/reactnative.png"
        style={{ position: 'absolute', top: 380, left: 900, width: 300 }}
/>

<img src="./logos/expo.png" style={{ position: 'absolute', top: 540, left: 790, width: 180 }} />

---

# 2 years later...

<div
        style={{
                display: 'flex',
                width: '100%',
                alignItems: 'center',
                justifyContent: 'space-around',
        }}
>
        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                <img src="./logos/gatsby.png" style={{ width: 500, marginBottom: 30 }} />
                <img src="./novela.jpg" style={{ width: 500, alignSelf: 'center' }} />
        </div>
        <img src="./first-blog.png" style={{ width: 500, alignSelf: 'center' }} />
</div>

---

<img
        src="./venn.png"
        style={{
                height: 400,
                alignSelf: 'center',
        }}
/>

- React-Native / Expo on a static website?
- Markdown / MDX in a app React-Native?
- Cross-platform interactive content?

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 150,
                        textAlign: 'center',
                }}
        >
                Part 1
        </h1>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                Gatsby
        </div>
</div>

---

### Gatsby

- Static site generator
- React
- SPA
- GraphQL data layer
- incremetal build
- MDX

---

### MDX

- React in Markdown
- WIP: Vue, Svelte

```mdx
# Hello world!

I can import and use React components:

import MyComponent from './myComponent';

<MyComponent age={42}>
```

---

### React-Native-Web

- ReactNative -> ReactDOM
- babel-plugin-react-native-web

```jsx
import { View, Text } from 'react-native';
```

becomes

```jsx
import { View, Text } from 'react-native-web';
```

---

### React-Native-Web

```jsx
export const View = (props) => (
        <div
                {...props}
                style={{
                        // override possible
                        flexDirection: 'column',

                        ...props.style,

                        // override not possible
                        display: 'flex',
                }}
        />
);

export const Text = (props) => <span {...props} />;
```

---

### Gatsby + React-Native-Web

Server-side rendering

```jsx
AppRegistry.registerComponent('App', () => App);
const { element, getStyleElement } = AppRegistry.getApplication('App', { initialProps });

// Render the app
const html = ReactDOMServer.renderToString(element);

// Extract critical CSS
const css = ReactDOMServer.renderToStaticMarkup(getStyleElement());

const document = `<!DOCTYPE html>
<html>
    <head>
        <style>${css}</style>
    </head>
    <body>${html}</body>
</html>`;
```

---

### Gatsby + React-Native-Web

```jsx
import React from 'react';
import { StyleSheet, TouchableOpacity, Text, View } from 'react-native';
import Link from 'gatsby-link';

const styles = StyleSheet.create({
        // ...
});

const IndexPage = () => (
        <View style={styles.box}>
                <Text style={styles.text}>Hi this is React-Native-Web rendered by Gatsby</Text>

                <TouchableOpacity style={styles.button} onPress={() => alert('it works')}>
                        <Text style={styles.buttonText}>Button</Text>
                </TouchableOpacity>

                <Link to="/page-2/">Go to page 2</Link>
        </View>
);
```

---

### Gatsby + React-Native-Web

<img
        src="./demos/v1.gif"
        style={{
                width: 900,
                alignSelf: 'center',
        }}
/>

---

### Gatsby + React-Native-Web

```jsx
import { TouchableOpacity, Text } from 'react-native';

export const MyRNButton = () => (
        <TouchableOpacity
                onPress={() => alert('onPress')}
                style={{
                        padding: 10,
                        backgroundColor: 'blue',
                        borderRadius: 5,
                }}
        >
                <Text style={{ color: 'white' }}>Click me</Text>
        </TouchableOpacity>
);
```

- ReactNative only
- Cross-platform

---

### Gatsby + React-Native-Web

```jsx
import React from 'react';
import { Link } from 'gatsby';
import { View, Text } from 'react-native';
import { MyRNButton } from './components';

const MyGatsbyPage = () => (
        <div>
                <h1>Gatsby page title</h1>
                <View>
                        <Text>Some RN text</Text>
                </View>
                <MyRNButton />
                <Link to="/nextGatsbyPage">Next</Link>
        </div>
);
```

- ReactNative + ReactDOM
- Not cross-platform

---

### Gatsby + React-Native-Web + MDX

```mdx
# Blog title

blabla this is a MDX blog post using an embedded RN button:

import { MyRNButton } from './components';

<MyRNButton onPress={() => alert("pressed")}>
      Click me
</MyRNButton/>
```

```jsx
import React from 'react';
import MyMDXComponent from './myMDXFile.mdx';

const MyGatsbyPage = () => <MyMDXComponent />;
```

---

### Gatsby + React-Native-Web + MDX

<img
        src="./demos/mdx.gif"
        style={{
                width: 900,
                alignSelf: 'center',
        }}
/>

---

### Limits

- No .web.js extension
- No TypeScript
- No RN lib transpilation
- No `__DEV__`
- No Expo
- ...

---

### Expo

<img
        src="./logos/expo.png"
        style={{
                width: 200,
                alignSelf: 'center',
        }}
/>

- Best React-Native DX
- React-Native: lean core
- Expo: "extend" React-Native core
- More APIs: video, audio, file system...
- Partial web support

---

### Gatsby + Expo

- [@expo/webpack-config](https://www.npmjs.com/package/@expo/webpack-config)

```jsx
import { withUnimodules } from '@expo/webpack-config/addons';

export const onCreateWebpackConfig = ({ actions, getConfig }) => {
        const gatsbyConfig = getConfig();

        const gatsbyConfigWithExpo = withUnimodules(gatsbyConfig);

        actions.replaceWebpackConfig(gatsbyConfigWithExpo);
};
```

- Gatsby, NextJS, Create-React-App, Electron...
- Thank you [Evan Bacon](https://twitter.com/Baconbrix)

---

### Gatsby + Expo + MDX

```mdx
# A React-Native video in my blog post

Hey, look at my Expo video:

import { Video } from 'expo-av';

<Video
        source={{ uri: 'https://someDomain/video.mp4' }}
        rate={1.0}
        isMuted={true}
        resizeMode="cover"
        shouldPlay={true}
        isLooping={true}
        style={{ width: 280 }}
/>
```

---

### Gatsby + Expo + MDX

<img
        src="./demos/expo-av.gif"
        style={{
                width: 900,
                alignSelf: 'center',
        }}
/>

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 150,
                        textAlign: 'center',
                }}
        >
                Part 2
        </h1>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                Back to mobile
        </div>
</div>

---

### React-Native + MDX

Step 1: source file:

```mdx
# title

some text

import { MyComponent } from './components';

<MyComponent answer={42} />
```

---

### React-Native + MDX

Step 2: MDX -> JSX (MDX compiler)

```jsx
import { MyComponent } from './components';

export const MDXComponent = () => (
        <div>
                <h1>title</h1>
                <p>some text</p>
                <MyComponent answer={42} />
        </div>
);
```

---

### React-Native + MDX

Step 3: JSX -> JS ([babel-plugin-transform-react-jsx](https://babeljs.io/docs/en/babel-plugin-transform-react-jsx))

```jsx
import React from 'react';
import { MyComponent } from './components';

export const MDXComponent = React.createElement('div', {
        children: [
                React.createElement('h1', undefined, (children: 'title')),
                React.createElement('p', undefined, (children: 'title')),
                React.createElement(MyComponent, { answer: 42 }, undefined),
        ],
});
```

---

### React-Native + MDX

Problems:

- React-DOM: div, h1, p...
- Can't run on React-Native

Solution:

- JSX Pragma
- [MDXProvider](https://mdxjs.com/advanced/components#mdxprovider): override React-DOM components

---

### JSX Pragma

babel-plugin-transform-react-jsx

```jsx
/** @jsx jsx */
import { jsx } from '@mdx-js/react';
import React from 'react';
import { MyComponent } from './components';

export const MDXComponent = () => (
        <div>
                <h1>title</h1>
                <p>some text</p>
                <MyComponent answer={42} />
        </div>
);
```

---

### JSX Pragma

After Babel

```jsx
import { jsx } from '@mdx-js/react';
import React from 'react';
import { MyComponent } from './components';

export const MDXComponent = jsx('div', {
        children: [
                jsx('h1', undefined, (children: 'title')),
                jsx('p', undefined, (children: 'title')),
                jsx(MyComponent, { answer: 42 }, undefined),
        ],
});
```

---

### MDXProvider

```jsx
import React from 'react';
import { MDXProvider } from '@mdx-js/react';
import { View, Text, Linking } from 'react-native';

const Div = (props) => <View>{props.children}</View>;

const P = (props) => <Text>{props.children}</Text>;

const A = (props) => (
        <Text accessibilityRole="link" onPress={() => Linking.openUrl(props.href)}>
                {props.children}
        </View>
);

export const ReactNativeMDXProvider = ({ children }) => (
        <MDXProvider components={{ div: Div, p: P, a: A }}>{children}</MDXProvider>
);
```

Override DOM components by React-Native implementations

---

### MDXProvider + JSX Pragma

```jsx
import { jsx } from '@mdx-js/react';
import React from 'react';
import { MyComponent } from './components';

export const MDXComponent = jsx('div', {
        children: [
                jsx('h1', undefined, (children: 'title')),
                jsx('p', undefined, (children: 'title')),
                jsx(MyComponent, { answer: 42 }, undefined),
        ],
});
```

```jsx
import { MDXComponent as MyBlogPostMDX } from './my-blog-post';

const App = () => (
        <ReactNativeMDXProvider>
                <MyBlogPostMDX />
        </ReactNativeMDXProvider>
);
```

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 150,
                        textAlign: 'center',
                }}
        >
                Demo
        </h1>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                React-Native + MDX
        </div>
</div>

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 150,
                        textAlign: 'center',
                }}
        >
                Partie 4
        </h1>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                Industrialisation
        </div>
</div>

---

### React-Navigation

- Navigation pour React-Native et Expo
- Web VS Mobile: patterns de navigation différents
- Tabs
- Stack
- Drawer

---

### React-Navigation

```jsx
const LinkedInTabNavigation = () => (
        <Tab.Navigator>
                <Tab.Screen component={FeedScreen} />
                <Tab.Screen component={NetworkScreen} />
                <Tab.Screen component={AddContentScreen} />
                <Tab.Screen component={NotificationsScreen} />
                <Tab.Screen component={JobsScreen} />
        </Tab.Navigator>
);

const LinkedInStackNavigation = () => (
        <Stack.Navigator>
                <Stack.Screen component={LinkedInTabNavigation} />
                <Stack.Screen component={MessagesScreen} />
                <Stack.Screen component={OtherStackScreens} />
        </Stack.Navigator>
);

const LinkedInNavigation = () => (
        <NavigationContainer>
                <LinkedInStackNavigation>
        </NavigationContainer>
);
```

---

### Static mobile app generator

Step 1: compiler MDX -> JSX (part1)

```jsx
// in: ./content/posts/my-super-post.mdx
// out: ./content/posts/my-super-post.mdx.jsx
// gitignore: *.mdx.jsx
const jsxFiles = glob.sync('./content/**/*.mdx').map((mdxFile) => {
        const mdxString = fs.readFileSync(mdxFile);
        const outputFile = mdxFile + '.jsx';
        fs.writeFileSync(outputFile, toJSXString(mdxString));
        return outputFile;
});
```

---

### Static mobile app generator

```jsx
const fs = require('fs');
const mdx = require('@mdx-js/mdx');
const glob = require('glob');
const grayMatter = require('gray-matter');

const toJSXString = (mdxString) => {
        const { data, content } = grayMatter(mdxString); // Extract frontmatter

        const frontmatter = `export const frontmatter = ${JSON.stringify(data)};`;

        const jsx = mdx.sync(content);

        const pragma = `/* @jsx mdx */
                        import { mdx } from '@mdx-js/react';`;

        return `
                ${pragma}
                ${frontMatterExport}
                ${jsx}
                `;
};
```

---

### Static mobile app generator

Step 2: générer la liste des posts

```jsx
// expose all blog posts, as an "index": AppBlogPostList.js
// export default [
//   require("./content/posts/my-super-post.mdx.jsx"),
//   require("./content/posts/another-post.mdx.jsx")
// ]
fs.writeFileSync(
        './AppBlogPostList.js',
        `export default [${jsxFiles.map((jsxFile) => `require('${jsxFile}')`).join(',\n')}]`,
);
```

---

### Static mobile app generator

Step 3: créer la navigation

```jsx
const BlogPostsNavigator = () => (
        <Stack.Navigator>
                <Stack.Screen name="BlogPostList" component={BlogPostListScreen} />
                <Stack.Screen
                        name="BlogPost"
                        component={BlogPostScreen}
                        options={({ route }) => ({
                                title: route.params.blogPost.frontmatter.title,
                        })}
                />
        </Stack.Navigator>
);

const AppNavigation = () => (
        <NavigationContainer>
                <BlogPostsNavigator />
        </NavigationContainer>
);
```

---

### Static mobile app generator

Step 4: écran BlogPostList

```jsx
const BlogPostListScreen = () => {
        const navigation = useNavigation();
        return (
                <ScrollView>
                        {SortedBlogPosts.map((blogPost, i) => (
                                <BlogPostCard
                                        blogPost={blogPost}
                                        key={i}
                                        onPress={() =>
                                                navigation.navigate('BlogPost', { blogPost })
                                        }
                                />
                        ))}
                </ScrollView>
        );
};
```

---

### Static mobile app generator

Step 5: écran BlogPost

```jsx
const BlogPostScreen = ({ blogPost }) => {
        const { default: MDXBlogPostContent, frontmatter } = blogPost;
        const navigation = useNavigation();
        return (
                <ScrollView>
                        <BlogPostHeader
                                frontmatter={frontmatter}
                                onBackPress={() => navigation.goBack()}
                        />
                        <MDXBlogPostContent />
                </ScrollView>
        );
};
```

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 150,
                        textAlign: 'center',
                }}
        >
                Demo
        </h1>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                React-Native + React-Navigation + MDX + Expo
        </div>
        <div
                style={{
                        fontSize: 60,
                        textAlign: 'center',
                }}
        >
                <a href="https://sebastienlorber.com/using-expo-in-gatsby" target="_blank">
                        sebastienlorber.com/using-expo-in-gatsby
                </a>
        </div>
</div>

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <div style={{ display: 'flex' }}>
                <img
                        src="./logos/expo.png"
                        style={{ alignSelf: 'center', width: 270, margin: 10 }}
                />
                <div
                        style={{
                                margin: 20,
                                padding: 10,
                                backgroundColor: 'white',
                        }}
                >
                        <img
                                src="./qrcode.png"
                                style={{
                                        width: 250,
                                        height: 250,
                                        alignSelf: 'center',
                                }}
                        />
                </div>
        </div>
        <div
                style={{
                        fontSize: 20,
                        textAlign: 'center',
                }}
        >
                <div>
                        <h4>iOS</h4>
                        login with gatsby-rnw / gatsby-rnw
                </div>
                <div>
                        <h4>Android</h4>
                        scan QRCode
                </div>
        </div>
        <a href="https://sebastienlorber.com/app" target="_blank">
                sebastienlorber.com/app
        </a>
</div>

---

<div
        style={{
                flex: 1,
                flexDirection: 'column',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
        }}
>
        <h1
                style={{
                        fontSize: 100,
                        textAlign: 'center',
                }}
        >
                THE END
        </h1>
</div>

- [twitter.com/sebastienlorber](https://twitter.com/sebastienlorber)
- [sebastienlorber.com](https://sebastienlorber.com/)
- [sebastienlorber.com/linkedin](https://sebastienlorber.com/linkedin)
- [sebastienlorber.com/newsletter](https://sebastienlorber.com/newsletter)
- [sebastienlorber.com/app](https://sebastienlorber.com/app)
- [sebastienlorber.com/using-expo-in-gatsby](https://sebastienlorber.com/using-expo-in-gatsby)
- [github.com/slorber/sebastienlorber.com](https://github.com/slorber/sebastienlorber.com)
- [slides-gatsby-expo.netlify.app](https://slides-gatsby-expo.netlify.app/)
